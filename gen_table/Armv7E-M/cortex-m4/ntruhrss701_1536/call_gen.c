
#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <assert.h>

#include "NTT_params.h"

#include "tools.h"
#include "gen_table.h"

#define BUFF_MAX (NTT_N << 3)

struct compress_profile profile;

static const int32_t streamlined_CT_table_Q1[NTT_N - 1] = {
-1736566, -1736566, -1736566, -4592671, -1736566, -4592671, -1183523, -955740, -4592671, -1183523, -955740, -3265592, -651242, -3342045, 1143822, -1736566, -1736566, -4592671, -1736566, -4592671, -1183523, -955740, -4592671, -1183523, -955740, -3265592, -651242, -3342045, 1143822, -1183523, -3265592, -651242, -4623697, -2618113, 919438, -5104170, -955740, -3342045, 1143822, -2165770, -4934154, -3538719, 1366526, -3265592, -4623697, -2618113, -4216973, 5504217, 4471856, 2924052, -651242, 919438, -5104170, -4388108, 1047781, -3754063, -437273, -3342045, -2165770, -4934154, 889203, 4908578, -5448948, -1386312, 1143822, -3538719, 1366526, 4017397, -3570786, -5650407, 4368942, -4623697, -4216973, 5504217, -2909086, -5617415, 3328439, -5712161, -2618113, 4471856, 2924052, 2372748, 2461475, -1427329, -2647867, 919438, -4388108, 1047781, -461616, -5470564, -4230938, 834761, -5104170, -3754063, -437273, -1023002, 1151154, 173452, 180829, -2165770, 889203, 4908578, 5019724, -1104900, -4748319, 1258227, -4934154, -5448948, -1386312, 2968606, 4109178, 1187957, 5372775, -3538719, 4017397, -3570786, -2294405, -2156126, -3459455, 1291258, 1366526, -5650407, 4368942, -104746, -1181803, 2612317, -2640054
};

static const int32_t mul_Rmod_table_Q1[NTT_N] = {
-1736566, -4592671, -1183523, -955740, -3265592, -651242, -3342045, 1143822, -4623697, -2618113, 919438, -5104170, -2165770, -4934154, -3538719, 1366526, -4216973, 5504217, 4471856, 2924052, -4388108, 1047781, -3754063, -437273, 889203, 4908578, -5448948, -1386312, 4017397, -3570786, -5650407, 4368942, -2909086, -5617415, 3328439, -5712161, 2372748, 2461475, -1427329, -2647867, -461616, -5470564, -4230938, 834761, -1023002, 1151154, 173452, 180829, 5019724, -1104900, -4748319, 1258227, 2968606, 4109178, 1187957, 5372775, -2294405, -2156126, -3459455, 1291258, -104746, -1181803, 2612317, -2640054
};

static const int32_t streamlined_inv_CT_table_Q1[NTT_N - 1] = {
-1736566, -1736566, -1736566, 4592671, -1736566, 955740, 4592671, 1183523, 4592671, 955740, 1183523, -1143822, 651242, 3342045, 3265592, -1736566, -1736566, 4592671, -1736566, 955740, 4592671, 1183523, -1366526, -4368942, 5650407, 2640054, 1181803, -2612317, 104746, -1143822, -1366526, 3538719, -4368942, 3570786, 5650407, -4017397, 5104170, 437273, 3754063, -180829, -1151154, -173452, 1023002, 955740, -1143822, 3342045, -1366526, 4934154, 3538719, 2165770, 4934154, 1386312, 5448948, -5372775, -4109178, -1187957, -2968606, 651242, 5104170, -919438, 437273, -1047781, 3754063, 4388108, 2618113, -2924052, -4471856, 2647867, -2461475, 1427329, -2372748, 4592671, 955740, 1183523, -1143822, 651242, 3342045, 3265592, 3538719, 3570786, -4017397, -1291258, 2156126, 3459455, 2294405, 3342045, 4934154, 2165770, 1386312, -4908578, 5448948, -889203, -919438, -1047781, 4388108, -834761, 5470564, 4230938, 461616, 1183523, 651242, 3265592, 5104170, 2618113, -919438, 4623697, 2165770, -4908578, -889203, -1258227, 1104900, 4748319, -5019724, 3265592, 2618113, 4623697, -2924052, -5504217, -4471856, 4216973, 4623697, -5504217, 4216973, 5712161, 5617415, -3328439, 2909086
};

int main(void){

// ================================

    int32_t buff[BUFF_MAX];

    int32_t mod_int32;
    int32_t scale_int32;
    int32_t omega_int32;

// ================================

    profile.compressed_layers = 3;
    profile.merged_layers[0] = 1;
    profile.merged_layers[1] = 3;
    profile.merged_layers[2] = 3;

    scale_int32 = RmodQ1;
    mod_int32 = Q1;
    omega_int32 = omegaQ1;
    gen_streamlined_CT_table_generic(
        buff,
        &scale_int32, &omega_int32,
        &mod_int32,
        sizeof(int32_t),
        mulmod_int32,
        &profile, 0
    );

    for(size_t i = 0; i < NTT_N - 1; i++){
        assert(streamlined_CT_table_Q1[i] == buff[i]);
    }

// ================================

    scale_int32 = RmodQ1;
    omega_int32 = omegaQ1;
    mod_int32 = Q1;
    gen_mul_table_generic(
        buff,
        &scale_int32, &omega_int32,
        &mod_int32,
        sizeof(int32_t),
        mulmod_int32
    );

    for(size_t i = 0; i < (NTT_N >> 1); i++){
        assert(mul_Rmod_table_Q1[i] == buff[i]);
    }

// ================================

    scale_int32 = RmodQ1;
    mod_int32 = Q1;
    omega_int32 = invomegaQ1;
    gen_streamlined_inv_CT_table_generic(
        buff,
        &scale_int32, &omega_int32,
        &mod_int32,
        sizeof(int32_t),
        mulmod_int32,
        expmod_int32,
        &profile, 0
    );

    for(size_t i = 0; i < NTT_N - 1; i++){
        assert(streamlined_inv_CT_table_Q1[i] == buff[i]);
    }

// ================================

    printf("Well done!\n");

}























