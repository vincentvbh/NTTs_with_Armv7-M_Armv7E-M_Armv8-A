#ifndef NTT_H
#define NTT_H

#include "NTT_params.h"
#include <stdint.h>

extern void __asm_ntt_0_1_2(int32_t *des, const int32_t *root_table, int32_t Qprime, int32_t Q, int16_t *src);
extern void __asm_ntt_0_1_2_small(int32_t *des, const int32_t *root_table, int32_t Qprime, int32_t Q, int8_t *src);
extern void __asm_ntt_3_4_5_6_7_8(int32_t *src, const int32_t *root_table, int32_t Qprime, int32_t Q);
extern void __asm_base_mul(int32_t *des, const int32_t *root_table, int32_t Qprime, int32_t Q, int32_t *src1, int32_t *src2);
extern void __asm_intt(int32_t *src, const int32_t *root_table, int32_t Qprime, int32_t Q);
extern void __asm_final_map(int16_t *des, const int32_t *_final_const, int32_t Qprime, int32_t Q, int32_t *src);

const int32_t final_const[8] = {
invN_R2modQ1, NTRU_Q_bar, NTRU_Q, Q1_bar
};

const int32_t streamlined_CT_table_Q1[NTT_N - 1] = {
7545561, 7545561, -5323499, 7545561, -5323499, -1230763, 2665066, 7545561, 7545561, -5323499, 7545561, -5323499, -1230763, 2665066, -5323499, -1230763, 2665066, -2744550, -925248, 1223606, -5807989, -1230763, -2744550, -925248, -3866102, 4245820, 5337436, -4125005, 2665066, 1223606, -5807989, -3601300, -116330, -3541078, 6581103, -2744550, -3866102, 4245820, 6233351, 4381854, -2373486, -2762564, -925248, 5337436, -4125005, 6677050, 2933299, -1478489, -2011956, 1223606, -3601300, -116330, 1339044, -892374, -5458435, 6701459, -5807989, -3541078, 6581103, -2678115, -580676, 4657054, 885166, 7545561, 7545561, -5323499, 7545561, -5323499, -1230763, 2665066, -5323499, -1230763, 2665066, -2744550, -925248, 1223606, -5807989, -1230763, -2744550, -925248, -3866102, 4245820, 5337436, -4125005, 2665066, 1223606, -5807989, -3601300, -116330, -3541078, 6581103, -2744550, -3866102, 4245820, 6233351, 4381854, -2373486, -2762564, -925248, 5337436, -4125005, 6677050, 2933299, -1478489, -2011956, 1223606, -3601300, -116330, 1339044, -892374, -5458435, 6701459, -5807989, -3541078, 6581103, -2678115, -580676, 4657054, 885166, -3866102, 6233351, 4381854, 3810555, -6163061, 7160480, 1714002, 4245820, -2373486, -2762564, 3470042, 5542801, 6529274, 3305295, 5337436, 6677050, 2933299, -757142, -4725924, -2933941, -2736881, -4125005, -1478489, -2011956, 3126405, -5061632, -5699528, -3059598, -3601300, 1339044, -892374, -1911909, -5429231, 1119343, -7069152, -116330, -5458435, 6701459, 910507, -146826, -1798774, -3110922, -3541078, -2678115, -580676, 5387575, -689803, 1817732, -5225661, 6581103, 4657054, 885166, -6188979, -6119065, -1087260, 2049299, 6233351, 3810555, -6163061, 66379, -5638058, 1215780, -6196634, 4381854, 7160480, 1714002, 1870895, 1531635, 367117, -1511483, -2373486, 3470042, 5542801, -7217976, -2667630, 650859, 3591012, -2762564, 6529274, 3305295, 3418164, 3705625, -736501, -6109530, 6677050, -757142, -4725924, -3005412, -1270168, 4184708, 6937366, 2933299, -2933941, -2736881, -2200142, -1883405, 835034, -3711019, -1478489, 3126405, -5061632, 3608780, 1951184, 2856801, 2233967, -2011956, -5699528, -3059598, 4332872, 2339317, -1231120, -2773526, 1339044, -1911909, -5429231, 4159299, 3467449, 4666305, 6616873, -892374, 1119343, -7069152, -3561000, -7095918, -4235539, 7053483, -5458435, 910507, -146826, 861760, -4359736, -4456561, 2491775, 6701459, -1798774, -3110922, 5815556, -623555, -1021638, 2221643, -2678115, 5387575, -689803, 3198625, -2812242, -6749300, 5107847, -580676, 1817732, -5225661, -6249975, -3112610, 132618, 2834575, 4657054, -6188979, -6119065, 3140943, -3912532, 1135005, -32952, 885166, -1087260, 2049299, -4594790, 4921985, -6483161, -5388750, 3810555, 66379, -5638058, -680040, 1060398, 6640886, -2922244, -6163061, 1215780, -6196634, -857325, 4262418, 6722467, 1238698, 7160480, 1870895, 1531635, -282288, 3857773, -507568, -6092974, 1714002, 367117, -1511483, -4933705, -552645, 2186308, 5352579, 3470042, -7217976, -2667630, 2895947, -342185, 1234054, -6633671, 5542801, 650859, 3591012, -4435615, 3067695, 862684, 7151861, 6529274, 3418164, 3705625, 5126998, 2940616, 4645897, -6036881, 3305295, -736501, -6109530, 2031312, 6751418, 4991838, -6742884, -757142, -3005412, -1270168, 6734258, -1966085, 5085963, 432942, -4725924, 4184708, 6937366, -1719198, -3968997, -2638959, 3102082, -2933941, -2200142, -1883405, -5602128, 4667000, 4836361, -1191323, -2736881, 835034, -3711019, -4400528, 3385749, -5916395, 5969125, 3126405, 3608780, 1951184, 2349292, 4001296, 7107312, 6360884, -5061632, 2856801, 2233967, 4132491, -3605997, -6389005, 6656064, -5699528, 4332872, 2339317, 3479286, 6893271, 3033374, 3940178, -3059598, -1231120, -2773526, 6396340, 6160026, -5934806, -6672740, -1911909, 4159299, 3467449, -2851121, 6620461, -3325715, 898461, -5429231, 4666305, 6616873, -2772766, -2701609, 5001718, 266171, 1119343, -3561000, -7095918, -3751200, -6576215, 340331, 5184673, -7069152, -4235539, 7053483, 3434017, -515691, 5229680, 2955152, 910507, 861760, -4359736, -3467125, 3477121, -4167246, -6920740, -146826, -4456561, 2491775, 6069201, 2625881, -6378860, 5122638, -1798774, 5815556, -623555, 3395065, 7214251, -5056654, 2361531, -3110922, -1021638, 2221643, 2660922, -5474867, 2750603, -3834742, 5387575, 3198625, -2812242, 826239, -175457, -330776, 1880669, -689803, -6749300, 5107847, 2242836, -3677328, 6074014, 6577233, 1817732, -6249975, -3112610, -6669175, -943261, 864942, -3882295, -5225661, 132618, 2834575, -6836672, -4713259, 307584, 1554626, -6188979, 3140943, -3912532, 4370648, -223158, 6085085, 3273553, -6119065, 1135005, -32952, -2196580, 3894488, -5518004, 1769125, -1087260, -4594790, 4921985, 6365431, 4760630, 4351950, -3558511, 2049299, -6483161, -5388750, 6915372, -6680911, 4034285, -7123586
};

const int32_t streamlined_CT_small_table_Q1[8] = {
1, 1, 625891, 1, 625891, -5150982, -1067471
};

const int32_t mul_Rmod_table_Q1[NTT_N >> 1] = {
7545561, -5323499, -1230763, 2665066, -2744550, -925248, 1223606, -5807989, -3866102, 4245820, 5337436, -4125005, -3601300, -116330, -3541078, 6581103, 6233351, 4381854, -2373486, -2762564, 6677050, 2933299, -1478489, -2011956, 1339044, -892374, -5458435, 6701459, -2678115, -580676, 4657054, 885166, 3810555, -6163061, 7160480, 1714002, 3470042, 5542801, 6529274, 3305295, -757142, -4725924, -2933941, -2736881, 3126405, -5061632, -5699528, -3059598, -1911909, -5429231, 1119343, -7069152, 910507, -146826, -1798774, -3110922, 5387575, -689803, 1817732, -5225661, -6188979, -6119065, -1087260, 2049299, 66379, -5638058, 1215780, -6196634, 1870895, 1531635, 367117, -1511483, -7217976, -2667630, 650859, 3591012, 3418164, 3705625, -736501, -6109530, -3005412, -1270168, 4184708, 6937366, -2200142, -1883405, 835034, -3711019, 3608780, 1951184, 2856801, 2233967, 4332872, 2339317, -1231120, -2773526, 4159299, 3467449, 4666305, 6616873, -3561000, -7095918, -4235539, 7053483, 861760, -4359736, -4456561, 2491775, 5815556, -623555, -1021638, 2221643, 3198625, -2812242, -6749300, 5107847, -6249975, -3112610, 132618, 2834575, 3140943, -3912532, 1135005, -32952, -4594790, 4921985, -6483161, -5388750, -680040, 1060398, 6640886, -2922244, -857325, 4262418, 6722467, 1238698, -282288, 3857773, -507568, -6092974, -4933705, -552645, 2186308, 5352579, 2895947, -342185, 1234054, -6633671, -4435615, 3067695, 862684, 7151861, 5126998, 2940616, 4645897, -6036881, 2031312, 6751418, 4991838, -6742884, 6734258, -1966085, 5085963, 432942, -1719198, -3968997, -2638959, 3102082, -5602128, 4667000, 4836361, -1191323, -4400528, 3385749, -5916395, 5969125, 2349292, 4001296, 7107312, 6360884, 4132491, -3605997, -6389005, 6656064, 3479286, 6893271, 3033374, 3940178, 6396340, 6160026, -5934806, -6672740, -2851121, 6620461, -3325715, 898461, -2772766, -2701609, 5001718, 266171, -3751200, -6576215, 340331, 5184673, 3434017, -515691, 5229680, 2955152, -3467125, 3477121, -4167246, -6920740, 6069201, 2625881, -6378860, 5122638, 3395065, 7214251, -5056654, 2361531, 2660922, -5474867, 2750603, -3834742, 826239, -175457, -330776, 1880669, 2242836, -3677328, 6074014, 6577233, -6669175, -943261, 864942, -3882295, -6836672, -4713259, 307584, 1554626, 4370648, -223158, 6085085, 3273553, -2196580, 3894488, -5518004, 1769125, 6365431, 4760630, 4351950, -3558511, 6915372, -6680911, 4034285, -7123586
};

const int32_t streamlined_inv_CT_table_Q1[NTT_N - 1] = {
7545561, 7545561, 5323499, 7545561, -2665066, 5323499, 1230763, 7545561, 7545561, 5323499, 7545561, -2665066, 5323499, 1230763, 5807989, -6581103, 3541078, -885166, 580676, -4657054, 2678115, -2665066, 5807989, -1223606, -6581103, 116330, 3541078, 3601300, 925248, 4125005, -5337436, 2011956, -2933299, 1478489, -6677050, 5323499, -2665066, 1230763, 5807989, 925248, -1223606, 2744550, -1223606, 116330, 3601300, -6701459, 892374, 5458435, -1339044, 1230763, 925248, 2744550, 4125005, -4245820, -5337436, 3866102, 2744550, -4245820, 3866102, 2762564, -4381854, 2373486, -6233351, 7545561, 7545561, 5323499, 7545561, -2665066, 5323499, 1230763, -2049299, 5388750, 6483161, 7123586, 6680911, -4034285, -6915372, -885166, -2049299, 1087260, 5388750, -4921985, 6483161, 4594790, 3059598, 2773526, 1231120, 6672740, -6160026, 5934806, -6396340, -6581103, -885166, -4657054, -2049299, 6119065, 1087260, 6188979, 3110922, -2221643, 1021638, 3834742, 5474867, -2750603, -2660922, 2011956, 3059598, 5699528, 2773526, -2339317, 1231120, -4332872, -3305295, 6109530, 736501, 6742884, -6751418, -4991838, -2031312, 5807989, -6581103, 3541078, -885166, 580676, -4657054, 2678115, 5225661, -2834575, -132618, -1554626, 4713259, -307584, 6836672, -6701459, 3110922, 1798774, -2221643, 623555, 1021638, -5815556, 2736881, 3711019, -835034, -5969125, -3385749, 5916395, 4400528, 4125005, 2011956, 1478489, 3059598, 5061632, 5699528, -3126405, 7069152, -7053483, 4235539, -2955152, 515691, -5229680, -3434017, 2762564, -3305295, -6529274, 6109530, -3705625, 736501, -3418164, -1714002, 1511483, -367117, -5352579, 552645, -2186308, 4933705, -2665066, 5807989, -1223606, -6581103, 116330, 3541078, 3601300, 6119065, 32952, -1135005, -1769125, -3894488, 5518004, 2196580, 580676, 5225661, -1817732, -2834575, 3112610, -132618, 6249975, 5061632, -2233967, -2856801, -6656064, 3605997, 6389005, -4132491, 116330, -6701459, 5458435, 3110922, 146826, 1798774, -910507, 146826, -2491775, 4456561, -5122638, -2625881, 6378860, -6069201, -2933299, 2736881, 2933941, 3711019, 1883405, -835034, 2200142, -5542801, -3591012, -650859, -7151861, -3067695, -862684, 4435615, 925248, 4125005, -5337436, 2011956, -2933299, 1478489, -6677050, 689803, -5107847, 6749300, -6577233, 3677328, -6074014, -2242836, 892374, 7069152, -1119343, -7053483, 7095918, 4235539, 3561000, 4725924, -6937366, -4184708, -3102082, 3968997, 2638959, 1719198, -4245820, 2762564, 2373486, -3305295, -5542801, -6529274, -3470042, 5429231, -6616873, -4666305, -266171, 2701609, -5001718, 2772766, -4381854, -1714002, -7160480, 1511483, -1531635, -367117, -1870895, 6163061, 6196634, -1215780, -1238698, -4262418, -6722467, 857325, 5323499, -2665066, 1230763, 5807989, 925248, -1223606, 2744550, 1087260, -4921985, 4594790, 3558511, -4760630, -4351950, -6365431, -4657054, 6119065, 6188979, 32952, 3912532, -1135005, -3140943, 5699528, -2339317, -4332872, -3940178, -6893271, -3033374, -3479286, 3541078, 580676, 2678115, 5225661, 689803, -1817732, -5387575, 1798774, 623555, -5815556, -2361531, -7214251, 5056654, -3395065, 1478489, 5061632, -3126405, -2233967, -1951184, -2856801, -3608780, -6529274, -3705625, -3418164, 6036881, -2940616, -4645897, -5126998, -1223606, 116330, 3601300, -6701459, 892374, 5458435, -1339044, -1817732, 3112610, 6249975, 3882295, 943261, -864942, 6669175, 5458435, 146826, -910507, -2491775, 4359736, 4456561, -861760, 2933941, 1883405, 2200142, 1191323, -4667000, -4836361, 5602128, -5337436, -2933299, -6677050, 2736881, 4725924, 2933941, 757142, -1119343, 7095918, 3561000, -5184673, 6576215, -340331, 3751200, 2373486, -5542801, -3470042, -3591012, 2667630, -650859, 7217976, -7160480, -1531635, -1870895, 6092974, -3857773, 507568, 282288, 1230763, 925248, 2744550, 4125005, -4245820, -5337436, 3866102, 6188979, 3912532, -3140943, -3273553, 223158, -6085085, -4370648, 2678115, 689803, -5387575, -5107847, 2812242, 6749300, -3198625, -3126405, -1951184, -3608780, -6360884, -4001296, -7107312, -2349292, 3601300, 892374, -1339044, 7069152, 5429231, -1119343, 1911909, -910507, 4359736, -861760, 6920740, -3477121, 4167246, 3467125, -6677050, 4725924, 757142, -6937366, 1270168, -4184708, 3005412, -3470042, 2667630, 7217976, 6633671, 342185, -1234054, -2895947, 2744550, -4245820, 3866102, 2762564, -4381854, 2373486, -6233351, -5387575, 2812242, -3198625, -1880669, 175457, 330776, -826239, -1339044, 5429231, 1911909, -6616873, -3467449, -4666305, -4159299, 757142, 1270168, 3005412, -432942, 1966085, -5085963, -6734258, 3866102, -4381854, -6233351, -1714002, 6163061, -7160480, -3810555, 1911909, -3467449, -4159299, -898461, -6620461, 3325715, 2851121, -6233351, 6163061, -3810555, 6196634, 5638058, -1215780, -66379, -3810555, 5638058, -66379, 2922244, -1060398, -6640886, 680040
};

#define NTT_forward(out, in){ \
    __asm_ntt_0_1_2(out, streamlined_CT_table_Q1, Q1prime, Q1, in); \
    __asm_ntt_3_4_5_6_7_8(out, streamlined_CT_table_Q1, Q1prime, Q1); \
}
#define NTT_forward_small(out, in){ \
    __asm_ntt_0_1_2_small(out, streamlined_CT_small_table_Q1, Q1prime, Q1, in); \
    __asm_ntt_3_4_5_6_7_8(out, streamlined_CT_table_Q1, Q1prime, Q1); \
}
#define NTT_mul(out, in1, in2) __asm_base_mul(out, mul_Rmod_table_Q1, Q1prime, Q1, in1, in2)
#define NTT_inv(out, in){ \
    __asm_intt(in, streamlined_inv_CT_table_Q1, Q1prime, Q1); \
    __asm_final_map(out, final_const, Q1prime, Q1, in); \
}


#endif





